---
title: 'Push Notifications'
---

The wazo-platform can generate push notifications for mobile users, through the wazo-webhookd
component.

wazo-webhookd manages subscriptions to internal platform events, such that custom behavior can be
triggered in reaction to those events. This allows, for example, for components external to the
wazo-platform to be notified of those events, in effect allowing for asynchronous integrations with
other systems. See [wazo-webhookd documentation page](/uc-doc/system/wazo-webhookd.md) for more
details.

As well as supporting configuration of custom behavior through http subscriptions(created through
the REST API) and custom python plugins, wazo-webhookd also automatically creates and manages
special subscriptions for mobile users, in order to support push notifications for relevant
wazo-platform events, such as calls to mobile-enabled users, voicemails, missed calls, etc.

When a mobile user logs in, authentication events generated by that user login are handled by
wazo-webhookd, which in turn creates a subscription for that user. That subscription specifies the
internal events which are relevant for push notifications to mobile users. When those events are
emitted by the platform, the subscription triggers the "hook" code that generates the relevant push
notification, by interacting with the configured push notification servers.

![Mobile push notifications diagram](/diagrams/mobile-mobile-push.svg)

## Configuring push notifications

For push notifications to be supported, at least one of the supported push notification service must
be configured.

Currently, the supported push notification services are Firebase Cloud Messaging(FCM) for android
clients, and Apple Push Notification Service(APNS) for iOS clients.

### Configuring FCM support

Note: [Since release 24.07](/uc-doc/upgrade/upgrade_notes#24-07), wazo-webhookd supports FCM HTTP
API v1, deprecating support for legacy APIs.

The configuration procedure is as follow:

1. **create a firebase project and enable firebase cloud messaging API support**  
   To support relaying notifications to android mobile users through FCM service, one must first
   have an active Firebase project account with Firebase Cloud Messaging support enabled for that
   FCM project.  
   See [Official Firebase documentation](https://firebase.google.com/docs/web/setup/#create-project)
   for more information.
2. **create a service account in the firebase project**  
   With a firebase project account and FCM API enabled, a service account must be created in the
   project; That service account will be used by wazo to authenticate to firebase APIs.  
   See
   [google cloud service account documentation](https://cloud.google.com/iam/docs/service-accounts-create?hl=en)
   for more information;
3. **download the service account json credentials file**  
   A JSON file containing the service account credentials can be downloaded from the Firebase
   console;  
   See
   [Firebase documentation](https://firebase.google.com/docs/admin/setup#initialize_the_sdk_in_non-google_environments).
4. **create an external config in wazo-auth, providing the content of the downloaded service account
   credentials**  
   Using wazo-auth REST API, the endpoint `/0.1/external/mobile/config` is used to manage the
   configuration for mobile push notifications support;  
   `POST` on that endpoint will create a fresh configuration if none exist, and `PUT` will allow
   updating the fields of that configuration;  
   the `fcm_service_account_info` field must be filled with the content of the downloaded json file
   from step 3(as a json string);  
   the `fcm_sender_id` is also required and should be the FCM project number assigned to the
   project, as shown in the firebase console;  
   see the
   [API reference](/documentation/api/authentication.html#tag/external/paths/~1external~1%7Bauth_type%7D~1config/post)
   for more details on that endpoint.

## Push notification types

Here are the push notification types which are currently generated by the wazo platform.

- `incomingCall`: a user-facing push notification to notify that the user is currently receiving a
  call, which they have a chance to answer; the notification data includes call event data, such as
  caller id;
- `missedCall`: a user-facing push notification to notify that a call has been received and was not
  answered by the user(whether an automatic forward has occured or not);  
  the notification title indicates that there is a new missed call, and the notification body
  specifies the name and number of the caller;  
  the notification data includes call event data, such as caller id name and number;
- `voicemailReceived`: a user-facing push notification to notify that a voicemail has been left in
  the user's mailbox;  
   the notification title indicates that there is a new voicemail, and notification body includes the
  caller id of the voicemail author(caller);  
   the notification data includes the voicemail event data;
- `messageReceived`: a user-facing push notification which indicates to the user that a chat message
  has been sent to(and received by) them;  
  the notification title will be the alias of the sender, and the body will be the content of the
  message; the notification data includes message event data;
- `cancelIncomingCall`: a data-only push notification which tells the mobile app to ignore a
  previous `incomingCall` notification, and to cancel any action started as a result of that
  `incomingCall`;  
   the notification data includes call cancel event data;
